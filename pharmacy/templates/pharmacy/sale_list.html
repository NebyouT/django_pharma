{% extends 'pharmacy/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-3">
        <div class="col">
            <h2>Sales History</h2>
        </div>
        <div class="col text-end">
            <a href="{% url 'add_sale' %}" class="btn btn-primary">
                <i class="fas fa-plus"></i> New Sale
            </a>
        </div>
    </div>

    <ul class="nav nav-tabs mb-3" id="salesTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="today-tab" data-bs-toggle="tab" data-bs-target="#today" type="button" role="tab">
                Today's Sales
                <span class="badge bg-primary">{{ today_sales.count }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="yesterday-tab" data-bs-toggle="tab" data-bs-target="#yesterday" type="button" role="tab">
                Yesterday's Sales
                <span class="badge bg-primary">{{ yesterday_sales.count }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="weekly-tab" data-bs-toggle="tab" data-bs-target="#weekly" type="button" role="tab">
                Weekly Sales
                <span class="badge bg-primary">{{ weekly_sales.count }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="monthly-tab" data-bs-toggle="tab" data-bs-target="#monthly" type="button" role="tab">
                Monthly Sales
                <span class="badge bg-primary">{{ monthly_sales.count }}</span>
            </button>
        </li>
    </ul>

    <div class="tab-content" id="salesTabContent">
        <div class="tab-pane fade show active" id="today" role="tabpanel" aria-labelledby="today-tab">
            <div class="card mb-3">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for sale in today_sales %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ sale.medicine.item_description }} - {{ sale.quantity }} units</span>
                                <span>ETB {{ sale.total_price|floatformat:2 }}</span>
                            </li>
                        {% empty %}
                            <li class="list-group-item">No sales today</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="yesterday" role="tabpanel" aria-labelledby="yesterday-tab">
            <div class="card mb-3">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for sale in yesterday_sales %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ sale.medicine.item_description }} - {{ sale.quantity }} units</span>
                                <span>ETB {{ sale.total_price|floatformat:2 }}</span>
                            </li>
                        {% empty %}
                            <li class="list-group-item">No sales yesterday</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="weekly" role="tabpanel" aria-labelledby="weekly-tab">
            <div class="card mb-3">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for sale in weekly_sales %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ sale.medicine.item_description }} - {{ sale.quantity }} units</span>
                                <span>ETB {{ sale.total_price|floatformat:2 }}</span>
                            </li>
                        {% empty %}
                            <li class="list-group-item">No sales this week</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="monthly" role="tabpanel" aria-labelledby="monthly-tab">
            <div class="card mb-3">
                <div class="card-body">
                    <ul class="list-group list-group-flush">
                        {% for sale in monthly_sales %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>{{ sale.medicine.item_description }} - {{ sale.quantity }} units</span>
                                <span>ETB {{ sale.total_price|floatformat:2 }}</span>
                            </li>
                        {% empty %}
                            <li class="list-group-item">No sales this month</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var triggerTabList = [].slice.call(document.querySelectorAll('#salesTabs button'))
        triggerTabList.forEach(function(triggerEl) {
            var tabTrigger = new bootstrap.Tab(triggerEl)
            triggerEl.addEventListener('click', function(event) {
                event.preventDefault()
                tabTrigger.show()
            })
        })
    });
</script>
{% endblock %}
